generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Trip {
  id              String         @id @default(cuid())
  destination     String
  status          String         @default("DRAFT")
  startDate       DateTime?
  endDate         DateTime?
  price           Int?
  currency        String         @default("MXN")
  description     String?
  itinerary       String?
  recommendations String?
  policies        String?
  thumbnailId     String?
  notes           String?
  paymentPlanId   String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  bookings        Booking[]
  images          Image[]
  paymentPlan     PaymentPlan?   @relation(fields: [paymentPlanId], references: [id])
  includedItems   IncludedItem[] @relation("IncludedItemToTrip")
}

model IncludedItem {
  id          String  @id @default(cuid())
  name        String  @unique
  description String?
  trips       Trip[]  @relation("IncludedItemToTrip")
}

model PaymentPlan {
  id           String        @id @default(cuid())
  name         String        @unique
  description  String?
  installments Installment[]
  trips        Trip[]
}

model Installment {
  id             String      @id @default(cuid())
  description    String
  percentage     Int
  daysBeforeTrip Int
  paymentPlanId  String
  paymentPlan    PaymentPlan @relation(fields: [paymentPlanId], references: [id], onDelete: Cascade)
}

model Image {
  id     String  @id @default(cuid())
  src    String  @unique
  alt    String?
  tripId String
  trip   Trip    @relation(fields: [tripId], references: [id], onDelete: Cascade)
}

model User {
  id          String    @id @default(cuid())
  email       String    @unique
  name        String
  phone       String?
  createdAt   DateTime  @default(now())
  isSuscribed Boolean   @default(true)
  bookings    Booking[]
}

model Booking {
  bookingDate DateTime  @default(now())
  notes       String?
  userId      String
  tripId      String
  trip        Trip      @relation(fields: [tripId], references: [id], onDelete: Cascade)
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  payments    Payment[]

  @@id([userId, tripId])
}

model Payment {
  id            String   @id @default(cuid())
  amount        Int
  paymentDate   DateTime @default(now())
  method        String
  reference     String?
  bookingUserId String
  bookingTripId String
  booking       Booking  @relation(fields: [bookingUserId, bookingTripId], references: [userId, tripId], onDelete: Cascade)
}

model Review {
  id          String   @id @default(cuid())
  author      String
  quote       String
  isPublished Boolean  @default(false)
  createdAt   DateTime @default(now())
}
